<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="../../docs-assets/ico/favicon.png">

    <title>MyInfo Client</title>

    <!-- Bootstrap core CSS -->
    <link href="scripts/lib/Bootstrap/css/bootstrap.css" rel="stylesheet" />

    <!-- Custom styles for this template -->
    <link href="starter-template.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy this line! -->
    <!--[if lt IE 9]><script src="../../docs-assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
    <style>
        body {
            padding-top: 50px;
        }

        .starter-template {
            padding: 40px 15px;
            text-align: center;
        }

    </style>
</head>

<body>

    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">My Info</a>
            </div>
            <div class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li class="active"><a href="#">Home</a></li>
                </ul>
            </div><!--/.nav-collapse -->
        </div>
    </div>

    <div class="container">

        <div class="starter-template">
            

            <ul id="info"></ul>
            <div id="infoAdd" style="display:none">
                <h2>Add Info</h2>
                <div id="parentID"></div>
                <div id="parentName"></div>
                <input id="inpText" class="input-xxlarge" type="text" placeholder="Info Text" />
                <button id="btnSave" type="submit" class="btn btn-primary">Save</button>
            </div>


        </div>

    </div><!-- /.container -->
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="scripts/lib/Bootstrap/js/bootstrap.min.js"></script>
    <script src="scripts/jsrender.js"></script>

    <script>

        // URL to the Task Data Web Service
        // Local: http://localhost:49993/api/info
        var serviceURL = "http://info.domemory.net/api/info";

        /* Compile markup as named templates */
        $.templates({
            titleTemplate: "<tr><td colspan=3>{{>name}}</td></tr>",
            detailTemplate: "<tr><td>{{>name}}</td><td>Released: {{>releaseYear}}</td><td>director: {{>director}}</td></tr>",
            taskTemplate: "<tr><td>{{>Id}}</td><td>{{>Name}}</td><td>{{>Description}}</td><td>{{>Status}}</td></tr>",
            infoTemplate: "<li  id='{{:ID}}'>{{:Text}}</li>"
        });

        // current selection information
        var activeInfoID = 0;

        function CheckInfoStorage() {
            // save open items in the database
            setTimeout(function () {
                console.log('Checking cursor');
                SaveOpenInfos();
                CheckInfoStorage();
            }, 10000);
        }

        function SaveOpenInfos() {

            $('input').each(function (key, value) {
                SaveInfo(this.getAttribute('data-parentID'), this.value);
            });

            $('#inptext').val("")
        }
        //  Send the new info object to the server
        function SaveInfo(parentID, Text) {
            if (!parentID)
                return;

            info = {};
            info.parentid = parentID;
            info.text = Text;

            $('#inptext').val("")

            $.when($.ajax({ url: serviceURL, data: info, type: "post", datatype: "json" }))
                .then(function (response, textstatus, xhr) {
                    // add task to the list
                    // $('#tasklist').append($.render.tasktemplate(task));
                });
        };
        // add new information on click on item
        $('#info')

            .on('hover', 'li', function () {
                $(this).css("color", "red");
            })
            .on('click', 'li', function () {
                //$('#parentName').text($(this).text());
                //$('#parentID').text($(this).attr('id'));
                //$('#inpText')
                //    .val("")
                //    .focus();
                //$('#infoAdd').show();

                // get clicked info
                var clickID = $(this).attr('id');

                if (clickID === activeInfoID) {
                    var $info = $(this);
                    var $infos = $info.find('#infos');

                    if ($infos.length == 0) {
                        var $infos = $('<ul id="infos"></lu>');
                        $infos.appendTo($info);
                    };

                    $infos.append('<li> <input class="input-xxlarge unsaved" data-parentID="' + activeInfoID + '" type="text" placeholder="Info Text" />jjjjj</li>');

                    CheckInfoStorage();
                }
                else {
                    activeInfoID = clickID;
                }

            });

        // get info and visualize
        $.when($.ajax({ url: serviceURL, data: { id: "root" }, type: "GET", contentType: "application/json;charset=utf-8" }))
         .then(function (data, textstatus, xhr) {
             // console.log(response);
             $('#info').html('<ul>' + $.render.infoTemplate(data.InfoList) + '</ul>');
         });

        // create a new task
        //$('#inpText').on('focusout', function (e)
        //{
        //    e.preventDefault();
        //    info = {};
        //    info.parentID = $('#parentID').text();
        //    info.Text = $('#inpText').val();

        //    $('#inpText').val("")

        //    $.when($.ajax({ url: "api/info", data: info, type: "POST", dataType: "json"}))
        //     .then(function (response, textstatus, xhr)
        //     {
        //         // add task to the list
        //         // $('#tasklist').append($.render.taskTemplate(task));
        //     });

        //});


        // delete task
        $('#deletetask').click(function (e) {
            e.preventDefault();
            var task = { id: 4 };

            $.when($.ajax({ url: "http://localhost:49993/api/task/4", data: task, type: "DELETE", dataType: "json" }))
             .then(function (response, textstatus, xhr) {
                 // add task to the list
                 // $('#tasklist').append($.render.taskTemplate(task));
             });

        });


    </script>

</body>
</html>
